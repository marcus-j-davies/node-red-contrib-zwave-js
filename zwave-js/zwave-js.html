
<script src="zwave-js/client.js"></script>
<link rel="stylesheet" href="zwave-js/styles.css">
<script type="text/javascript">

    RED.nodes.registerType('zwave-js',
        {
            category: 'Smart Home',
            color: 'rgb(16,115,185)',
            defaults:
            {
                serialPort: { value: "Select Port" },
                name: { value: "ZWave-JS Controller" },
                encryptionKey : {value:""},
                ackTimeout:{value:""},
                controllerTimeout:{value:""},
                sendResponseTimeout:{value:""},
                loggingLevel:{value:"-1"},
                logFile:{value:""},
                logNodeFilter:{value:""}

            },
            inputs: 1,
            outputs: 1,
            icon: "ZWAVE.png",
            label: function () {
                return this.name;
            },
            onpaletteadd:ZwaveJsUI.init,
            oneditprepare:SortUI
        });


    function SortUI(Current) {
        Current = Current || this.serialPort;

        $.getJSON("zwjsgetports", function (data) {
            var selectLabel = "Select Port";
            var customLabel = "Custom...";
            var defaultOptions = data.concat([selectLabel, customLabel]);
            var options = [selectLabel]
                .concat(data)
                .concat(Current && !defaultOptions.includes(Current) ? [Current] : [])
                .concat([customLabel]);

            $("#node-input-serialPort")
                .empty()
                .append(
                    options.map(function (option) {
                        return new Option(option, option);
                    })
                )
                .val(Current)
                .unbind('change')
                .change(function (event) {
                    if (event.target.value === customLabel) {
                        var customPort = (prompt('Input your custom serial port', '') || '').trim();
                        SortUI(customPort || selectLabel);
                    }
                });
        });

        $.getJSON("zwjsgetversion",function(data){
            $("#MOD_Version").val(data.moduleversion)
            $("#ZWJS_Version").val(data.zwjsversion)
        })
    }



</script>

<script type="text/x-red" data-template-name="zwave-js">
    <p>
        <strong>Basic settings.</strong>
    </p>
    <div class="form-row">
        <label for="node-input-name" style="width:130px"><i class="fa fa-pencil"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Zwave Controller">
    </div>
    <div class="form-row">
        <label for="node-input-serialPort" style="width:130px"><i class="fa fa-pencil"></i> Serial Port</label>
        <select id="node-input-serialPort">
            <option value="Select Port">Select Port</option>
        </select>

    </div>
    <div class="form-row">
        <label for="node-input-encryptionKey" style="width:130px"><i class="fa fa-pencil"></i> Encryption Key</label>
        <input type="text" id="node-input-encryptionKey" placeholder="[0x01,0x02,..] or string">
    </div>
    <br />
    <p>
        <strong>Timeouts (ms).</strong>
    </p>
    <div class="form-row">
        <label  for="node-input-ackTimeout" style="width:130px"><i class="fa fa-pencil"></i> ACK</label>
        <input type="text" id="node-input-ackTimeout" placeholder="Use Default">
    </div>
    <div class="form-row">
        <label  for="node-input-controllerTimeout" style="width:130px"><i class="fa fa-pencil"></i> Controller</label>
        <input type="text" id="node-input-controllerTimeout" placeholder="Use Default">
    </div>
    <div class="form-row">
        <label  for="node-input-sendResponseTimeout" style="width:130px"><i class="fa fa-pencil"></i> Req -> Res</label>
        <input type="text" id="node-input-sendResponseTimeout" placeholder="Use Default">
    </div>
    <br />
    <p>
        <strong>Z-Wave JS Logging</strong>
    </p>
    <div class="form-row">
        <label  for="node-input-loggingLevel" style="width:130px"><i class="fa fa-pencil"></i> Log Level</label>
        <select id="node-input-loggingLevel">
            <option value="-1">Logging Disabled</option>
            <option value="0">Error</option>
            <option value="1">Warn</option>
            <option value="2">Info</option>
            <option value="3">Http</option>
            <option value="4">Verbose</option>
            <option value="5">Debug</option>
            <option value="6">Silly</option>
        </select>
    </div>
    <div class="form-row">
        <label  for="node-input-logFile" style="width:130px"><i class="fa fa-pencil"></i> Log File</label>
        <input type="text" id="node-input-logFile" placeholder="zwave-js-log.txt">
    </div>
    <div class="form-row">
        <label  for="node-input-logFile" style="width:130px"><i class="fa fa-pencil"></i> Node Filter</label>
        <input type="text" id="node-input-logNodeFilter" placeholder="2,5,24">
    </div>
    <br />
    <p>
        <strong>Version Information.</strong>
    </p>
    <div class="form-row">
        <label  for="MOD_Version" style="width:130px"><i class="fa fa-info"></i> Module Version</label>
        <input type="text" id="MOD_Version" readonly>
    </div>
    <div class="form-row">
        <label  for="ZWJS_Version" style="width:130px"><i class="fa fa-info"></i> Driver Version</label>
        <input type="text" id="ZWJS_Version" readonly>
    </div>
   
</script>

<script type="text/x-red" data-help-name="zwave-js">
    <p>A Zwave Controller for node red.</p>

    <p>
        <code>Input:</code><br />
        A <strong>payload</strong> object containing a command to send to a ZWave device.<br />
        <strong>params</strong> will be dependant on the <strong>class</strong> and <strong>operation</strong> being performed.
<pre>
{
   node: 2,
   class: "Configuration",
   operation: "Set",
   params: [0x18,0x03,1]
}
</pre>
    </p>

    <p>
        <code>Output:</code><br />
        A <strong>payload</strong> containing an event that has occured within the zwave network.<br />
        The contents of <strong>object</strong> is dependant on the event.
<pre>
{
   node: 2,
   event: "VALUE_UPDATED",
   timestamp: "23-12-2020T12:23:23+000",
   object: ...
}
</pre>
    </p>


</script>